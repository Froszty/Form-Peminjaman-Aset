{% set IS_IT = session.get('is_it') %}
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}Form Peminjaman Aset IT • PT Yakult Indonesia Persada{% endblock %}</title>

  <!-- Satoshi (Fontshare) -->
  <link href="https://api.fontshare.com/v2/css?f[]=satoshi@400,500,700,900&display=swap" rel="stylesheet">

  <style>
    :root{
      --yakult-red:#e60012; --yakult-red-2:#ff3b3b;
      --yakult-red-hover:#c30010; --yakult-red-hover-2:#ff2525;
      --bg:#f8f9fb; --card:#ffffffcc; --text:#111; --muted:#6b7280; --border:#e9edf2;
      --shadow:0 10px 30px rgba(0,0,0,.08); --shadow-strong:0 18px 44px rgba(0,0,0,.12);
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{
      margin:0;padding:0;
      font-family:"Satoshi",ui-sans-serif,system-ui,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,#fff,#fff 60%,#fef2f3 100%);
    }
    a{color:var(--yakult-red);text-decoration:none} a:hover{text-decoration:underline}

    /* Header */
    header{position:sticky;top:0;z-index:50;background:linear-gradient(90deg,var(--yakult-red),var(--yakult-red-2));color:#fff;border-bottom:1px solid rgba(255,255,255,.25);backdrop-filter:saturate(1.2) blur(8px);box-shadow:var(--shadow-strong)}
    .nav-wrap{max-width:1120px;margin:0 auto;padding:12px 18px;display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center}
    .brand .line1,.brand .line2{display:block;line-height:1.05;font-weight:800;text-transform:uppercase;font-size:18px}

    .topnav{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    .topnav a{
      color:#fff;text-decoration:none;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.28);
      transition:all .18s ease;font-weight:700;backdrop-filter:brightness(1.05);
      font-size:13.5px;
    }
    .topnav a:hover{
      background:linear-gradient(90deg,var(--yakult-red-hover),var(--yakult-red-hover-2));
      color:#fff; border-color:#ffffffb3; box-shadow:0 6px 18px rgba(230,0,18,.24);
    }
    .topnav a.active{background:#fff;color:var(--yakult-red);border-color:#fff;box-shadow:0 6px 18px rgba(255,255,255,.25)}
    .topnav.is-it{gap:6px}
    .topnav.is-it a{padding:6px 10px;font-size:15px;border-radius:999px}

    /* Kanan */
    .rightbox{display:grid;grid-template-columns:auto max-content;grid-template-rows:auto auto;align-items:center;gap:4px 12px}
    .company{grid-column:1/2;grid-row:1/2;font-weight:800;font-size:16px;text-align:right}
    .user{grid-column:1/2;grid-row:2/3;opacity:.95;font-size:12px;text-align:right}
    .logout-wrap{grid-column:2/3;grid-row:1/3;align-self:center}
    .logout-btn{padding:8px 12px;border-radius:999px;border:1px solid #ffffffb3;color:#fff;text-decoration:none;white-space:nowrap}
    .logout-btn:hover{background:linear-gradient(90deg,var(--yakult-red-hover),var(--yakult-red-hover-2)); border-color:#fff}

    /* Layout */
    main{max-width:1120px;margin:22px auto;padding:0 18px 10px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}

    /* Typography & helpers */
    h1,h2,h3{margin:0 0 10px 0}
    .muted{color:var(--muted)}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#fff;border:1px solid var(--border);box-shadow:var(--shadow);font-size:12px}

    /* Grid */
    .row{display:grid;gap:12px}
    .grid-2{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
    .grid-3{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}

    /* Forms */
    label{display:block;margin:.5rem 0 .25rem;color:var(--muted);font-size:13px}
    input,select,textarea{
      width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#fff;outline:none;
      transition:border-color .15s, box-shadow .15s;
      font-family:"Satoshi",inherit;
    }
    input:focus,select:focus,textarea:focus{border-color:var(--yakult-red);box-shadow:0 0 0 4px rgba(230,0,18,.08)}

    /* Signature area */
    .sig-wrap{background:linear-gradient(180deg,#fff,#fff7f8);border:1px dashed #d6dbe3;border-radius:14px;padding:10px;box-shadow:0 0 0 4px rgba(230,0,18,.06),0 8px 24px rgba(230,0,18,.12),inset 0 0 0 1px #ffffff}
    canvas.sig-canvas{width:100%;max-width:900px;height:220px;display:block;background:#fff;border-radius:12px;border:1px solid var(--border);touch-action:none;box-shadow:inset 0 0 24px rgba(230,0,18,.08)}

    /* Buttons */
    .btn{
      appearance:none; cursor:pointer; font-weight:800;
      padding:10px 14px; border-radius:999px;
      border:1px solid rgba(230,0,18,.45); background:transparent;
      color:var(--yakult-red);
      transition:all .18s ease;
      font-family:"Satoshi",inherit;
    }
    .btn:hover{background:rgba(230,0,18,.09)}
    .btn-primary{
      border-color:#fff; color:#fff;
      background:linear-gradient(90deg,var(--yakult-red),var(--yakult-red-2));
      box-shadow:0 6px 18px rgba(230,0,18,.22);
    }
    .btn-primary:hover{
      background:linear-gradient(90deg,var(--yakult-red-hover),var(--yakult-red-hover-2));
      color:#fff; border-color:#fff; transform:translateY(-1px);
      box-shadow:0 10px 22px rgba(230,0,18,.28);
    }
    .btn-outline{background:transparent;color:var(--yakult-red);border-color:rgba(230,0,18,.45)}
    .btn-sm{padding:7px 12px}
    .btn-xs{padding:5px 8px; font-size:12px; line-height:1.1}

    /* Baru: tombol 2 baris “tall” */
    .btn-tall{
      padding:8px 10px;
      line-height:1.05;
      display:inline-flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:2px;
      font-size:12.5px; /* cukup kecil agar muat */
      min-height:40px;  /* biar terasa ‘gendut ke bawah’ */
      white-space:normal;
      text-align:center;
    }
    .btn-tall span{display:block}

    /* Tables */
    table{width:100%;border-collapse:separate;border-spacing:0;background:#fff;border:1px solid var(--border);border-radius:14px;overflow:hidden;box-shadow:var(--shadow)}
    thead th{background:#fff5f6;color:#9b0a14;text-align:left;padding:12px 14px;border-bottom:1px solid var(--border);font-size:13px}
    tbody td{padding:12px 14px;border-bottom:1px solid var(--border);font-size:14px}
    tbody tr:hover{background:#fffafa}
    tbody tr:last-child td{border-bottom:none}

    /* Footer kredensial */
    footer.site-cred{
      max-width:1120px; margin:0 auto; padding:0 18px 28px;
      color:var(--yakult-red); font-size:18px; text-align:center;
    }

    /* Toast */
    .alerts{position:fixed;right:18px;bottom:18px;display:flex;flex-direction:column;gap:10px;z-index:60}
    @keyframes slideInUp{from{transform:translateY(12px);opacity:0}to{transform:translateY(0);opacity:1}}
    .alert{min-width:280px;max-width:420px;border-radius:14px;display:flex;align-items:flex-start;gap:10px;padding:12px 14px;box-shadow:0 14px 34px rgba(0,0,0,.16);animation:slideInUp .25s ease both;color:#122;border:1px solid var(--border);background:linear-gradient(180deg,#fff,#f8fafc)}
    .alert.success{border-color:#22c55e33;background:linear-gradient(180deg,#f0fff4,#ffffff)}
    .alert.info{border-color:#3b82f633;background:linear-gradient(180deg,#f0f7ff,#ffffff)}
    .alert.warning{border-color:#f59e0b33;background:linear-gradient(180deg,#fff8eb,#ffffff)}
    .alert.danger{border-color:#ef444433;background:linear-gradient(180deg,#fff1f2,#ffffff)}
    .alert .icon{width:20px;height:20px;margin-top:2px;flex:0 0 auto}
    .alert .content{flex:1}
    .alert .title{font-weight:800;margin-bottom:2px}
    .alert .close{appearance:none;border:none;background:transparent;font-size:18px;line-height:1;cursor:pointer;opacity:.6}
    .alert .close:hover{opacity:1}

    @media (max-width:640px){
      .topnav{display:none}
      .rightbox{grid-template-columns:1fr;grid-template-rows:auto auto auto}
      .logout-wrap{justify-self:end}
      thead{display:none}
      table,tbody,tr,td{display:block;width:100%}
      tbody tr{margin:10px 0;border:1px solid var(--border);border-radius:14px;overflow:hidden}
      tbody td{display:flex;justify-content:space-between;gap:8px}
      tbody td::before{content:attr(data-th);font-weight:800;color:var(--muted)}
    }
  </style>
  {% block head_extra %}{% endblock %}
</head>
<body>
  <header>
    <div class="nav-wrap">
      <!-- Kiri: judul -->
      <div class="brand">
        <span class="line1">Form Peminjaman</span>
        <span class="line2">Aset IT</span>
      </div>

      <!-- Tengah: nav -->
      {% if session.get('username') %}
        <nav class="topnav {% if IS_IT %}is-it{% endif %}">
          {% if IS_IT %}
            <a href="{{ url_for('dashboard') }}" class="{% if request.endpoint=='dashboard' %}active{% endif %}">Dashboard</a>
            <a href="{{ url_for('create_form') }}" class="{% if request.endpoint=='create_form' %}active{% endif %}">Buat Form</a>
            <a href="{{ url_for('submitted_list') }}" class="{% if request.endpoint in ['submitted_list','confirm_it'] %}active{% endif %}">Peminjaman</a>
            <a href="{{ url_for('returns_list') }}" class="{% if request.endpoint in ['returns_list','confirm_return_it'] %}active{% endif %}">Antrian Pengembalian</a>
            <a href="{{ url_for('history') }}" class="{% if request.endpoint=='history' %}active{% endif %}">History</a>
          {% else %}
            <a href="{{ url_for('dashboard') }}" class="{% if request.endpoint=='dashboard' %}active{% endif %}">Dashboard</a>
            <a href="{{ url_for('create_form') }}" class="{% if request.endpoint=='create_form' %}active{% endif %}">Create Form</a>
          {% endif %}
        </nav>
      {% endif %}

      <!-- Kanan -->
      <div class="rightbox">
        <div class="company">PT Yakult Indonesia Persada</div>
        {% if session.get('username') %}
          <div class="user">
            {{ session.get('display_name') or session.get('username') }}
            {% if IS_IT %} • IT{% elif session.get('user_division') %} • {{ session.get('user_division') }}{% endif %}
          </div>
          <div class="logout-wrap"><a class="logout-btn" href="{{ url_for('logout') }}">Logout</a></div>
        {% endif %}
      </div>
    </div>
  </header>

  <main>
    <div class="card">
      {% block content %}{% endblock %}
    </div>
  </main>

  <footer class="site-cred">
    © 2025 IT OPS — There's Always a Solution
  </footer>

  <!-- Toast -->
  <div class="alerts" id="alerts">
    {% with msgs = get_flashed_messages(with_categories=true) %}
      {% if msgs %}
        {% for cat,msg in msgs %}
          <div class="alert {{ cat|lower }}">
            <div class="icon">
              {% if cat|lower == 'success' %}
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none"><path d="M20 7L9 18l-5-5" stroke="#16a34a" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              {% elif cat|lower == 'danger' %}
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none"><path d="M12 8v5m0 3h.01M10.29 3.86l-7.2 12.48A2 2 0 0 0 4.8 20h14.4a2 2 0 0 0 1.71-3.66L13.71 3.86a2 2 0 0 0-3.42 0z" stroke="#dc2626" stroke-width="2"/></svg>
              {% elif cat|lower == 'warning' %}
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none"><path d="M12 8v5m0 3h.01M3 19h18L12 3 3 19z" stroke="#d97706" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
              {% else %}
                <svg viewBox="0 0 24 24" width="20" height="20" fill="none"><circle cx="12" cy="12" r="9" stroke="#2563eb" stroke-width="2"/><path d="M12 8h.01M11 12h1v4h1" stroke="#2563eb" stroke-width="2" stroke-linecap="round"/></svg>
              {% endif %}
            </div>
            <div class="content">
              <div class="title">
                {%- if cat|lower == 'danger' -%}Gagal
                {%- elif cat|lower == 'warning' -%}Perhatian
                {%- elif cat|lower == 'success' -%}Berhasil
                {%- else -%}Info
                {%- endif -%}
              </div>
              <div class="body">{{ msg }}</div>
            </div>
            <button class="close" aria-label="Close" onclick="this.closest('.alert')?.remove()">×</button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}
  </div>

  {% block scripts %}{% endblock %}
</body>
</html>
